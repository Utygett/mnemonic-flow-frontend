# Архитектурный контракт (FSD v2) для проекта

Этот документ фиксирует, **как именно** переносим проект на Feature‑Sliced Design по частям, что куда кладём и какие правила соблюдаем, чтобы структура не деградировала. [page:1]

## 1) Слои (layers) и правило импортов

### Слои, которые используем
Мы используем слои FSD (без Processes, он в спецификации помечен как deprecated). [page:1]

Порядок ответственности (сверху больше, снизу меньше):
- `app`
- `pages`
- `widgets`
- `features`
- `entities`
- `shared` [page:1]

### Главное правило импортов (must)
Файл внутри слайса может импортировать только слайсы **строго ниже по слоям**. [page:1]  
Пример: `features/cards-create/*` может импортировать из `entities/*` и `shared/*`, но **не** из `features/other-feature/*` и не из `widgets/pages/app`. [page:1]

Исключения: `app` и `shared` — это “слой=слайс”, внутри них сегменты могут импортировать друг друга свободно. [page:1]

## 2) Что лежит в каждом слое

### `shared/` — фундамент
Назначение: связь с внешним миром (API, env, 3rd‑party), базовые библиотеки и UI‑кит без бизнес‑логики. [page:1]  
Тут **нет бизнес‑слайсов**, поэтому `shared/*` можно импортировать везде. [page:1]

Типовые сегменты (мы придерживаемся этих имён):
- `shared/api` — базовый API‑клиент, обработка ошибок, refresh-token механика (низкоуровнево). [page:1]
- `shared/ui` — UI‑кит (Button/Input/Modal/MarkdownField и т.п.), без доменной логики. [page:1]
- `shared/lib` — маленькие сфокусированные библиотеки (dates/text/math и т.д.), не “помойка utils”. [page:1]
- `shared/config` — env, глобальные флаги, конфиги. [page:1]

Запрещено: слайды по доменам (типа `shared/cards`) и “бесхозные” папки `components/hooks/types` как основные сегменты. [page:1]

### `entities/` — доменные сущности
Назначение: понятия предметной области (Card, Deck, Group, User и т.п.). [page:1]  
Содержимое: типы/модель, API сущности, и переиспользуемое представление сущности (entity UI), но без сценариев. [page:1]

Обычно внутри слайса:
- `entities/<entity>/model` — типы, состояние (если есть), доменные хелперы. [page:1]
- `entities/<entity>/api` — запросы, относящиеся к сущности. [page:1]
- `entities/<entity>/ui` — компоненты отображения сущности, переиспользуемые на разных страницах. [page:1]

Важно: слайсы сущностей по умолчанию не знают друг о друге; связующую бизнес‑логику держим выше (features/pages). [page:1]

### `features/` — пользовательские действия (use-cases)
Назначение: “что пользователь делает” (создать карточку, отредактировать, импортировать CSV, логин и т.д.). [page:1]  
Фича может включать UI (форма), модель/валидацию, вызовы API, но должна быть **сфокусированной** (не “всё подряд”). [page:1]  
Принцип: “не всё — фича”; фичи особенно полезны, когда действие переиспользуется на нескольких страницах/в разных местах. [page:1]

### `widgets/` — крупные блоки интерфейса
Назначение: большие самодостаточные куски UI (shell/layout, таб-бар, крупные панели), особенно если они переиспользуются или крупно разгружают страницу. [page:1]  
Если блок не переиспользуется и составляет основную часть страницы — его можно держать прямо в `pages/*`, а не делать widget. [page:1]

### `pages/` — страницы/экраны
Назначение: маршрутизируемые экраны (Home/Study/Stats/Profile). [page:1]  
Содержимое: UI страницы, загрузки/ошибки, сборка виджетов/фич, минимальная “клейка”. [page:1]  
Страницы могут содержать заметный объём кода, если команде всё ещё легко ориентироваться. [page:1]

### `app/` — глобальная инфраструктура приложения
Назначение: провайдеры (AuthProvider), конфиг роутинга, глобальные стили, entrypoint, интеграции типа аналитики. [page:1]  
`app` не разбивается на бизнес‑домены (как и `shared`), это “верхняя сборка”. [page:1]

## 3) Сегменты внутри слайса (standard)

Для `pages/widgets/features/entities` используем одинаковые имена сегментов:
- `ui/` — React‑компоненты (View), максимально без side‑effects.
- `model/` — состояние/хуки, валидация, бизнес‑правила, селекторы.
- `api/` — запросы/мутации (на уровне сущности или сценария).
- `lib/` — локальные утилиты, относящиеся только к этому слайсу.
- `config/` — локальные флаги/конфиги фичи/виджета.

Почему так: сегменты должны описывать **назначение**, а не “сущность файлов”, поэтому не заводим корневые `hooks/`, `types/`, `components/` как обязательные сегменты (допускается только внутри `ui/` как подпапки, если нужно). [page:1]

## 4) Public API и правила экспорта

### Правило “вход только через index.ts”
Каждый слайс обязан иметь `index.ts` (Public API).  
Импортировать слайс снаружи можно **только** так:
- `import { X } from "features/cards-create";`
- `import { DeckCard } from "entities/deck";`

Запрещено:
- `import { X } from "features/cards-create/ui/CreateCardView";`

Зачем: так легче переносить файлы внутри слайса без переписывания импортов по всему проекту. [page:1]

## 5) Правила добавления/редактирования файлов

### Добавляем новое: чек‑лист
1) Определи ответственность:
   - это “фундамент/общая библиотека” → `shared`
   - “сущность” → `entities/<name>`
   - “действие пользователя” → `features/<name>`
   - “большой блок UI” → `widgets/<name>`
   - “экран/роут” → `pages/<name>`
   - “глобальная инфраструктура” → `app` [page:1]

2) Создай/используй существующий слайс и положи код в правильный сегмент (`ui/model/api/lib/config`).

3) Экспортируй через `index.ts` слайса (Public API).

4) Проверь импорты: только вниз по слоям (кроме `app/shared`). [page:1]

### Редактируем старое: правила миграции
- Не делаем “большой взрыв”: переносим фичу за фичей (например, сначала Cards: create/edit). [page:1]
- Разрешено временно иметь “старые” папки рядом, но каждую новую разработку стараемся сразу класть в FSD‑структуру.
- Любой рефакторинг сопровождаем заменой импортов на Public API (`.../index.ts`), чтобы проект не обрастал deep‑imports.

## 6) Принятые решения для этого проекта (фиксируем)

- **Processes не используем** (deprecated): многошаговые сценарии держим в `features` или в `app` на уровне роутинга. [page:1]
- `app` и `shared` — без бизнес‑слайсов, только сегменты. [page:1]
- Новый код: только через Public API слайса.
- “components/hooks/types” не являются верхнеуровневыми сегментами, используем `ui/model/api/lib/config`. [page:1]
